# Deployment Guide: Unleashing Your Crossplane Lab Empire üè∞‚öîÔ∏è

Buckle up, infrastructure warrior! This guide is your battle plan for deploying a full-blown Azure lab environment using Crossplane. We'll turn YAML into reality, provisioning VMs, networks, and more with the flick of a `kubectl` command. Think of it as assembling a LEGO castle, but instead of bricks, we have cloud resources. And the best part? Crossplane handles the heavy lifting (and cleanup) like a trusty sidekick. Let's make some magic happen! ‚ú®

## Quick Overview: What Are We Building?
Our lab isn't just any setup ‚Äì it's a complete Azure playground:
- **Networking**: VNet, subnets, NSGs, NAT gateway, public IPs.
- **Compute**: Multiple VMs (admin, portal, DB master/slave) with SSH access.
- **Web**: App Service Plan and Linux Web App for that extra flair.
- All orchestrated via Crossplane compositions, making it reusable and GitOps-friendly.

Why Crossplane? Because manual Azure portal clicking is so last season. Here, we declare what we want, and Crossplane makes it so. Plus, drift detection means if something changes (oops!), it auto-fixes it. No more "What happened to my VM?!" panics. üòÖ

## Prerequisites: Gear Up!
Before charging into battle, ensure:
- K8s cluster with Crossplane installed (via Helm ‚Äì see `docs/getting-ready.md` for the full setup saga).
- Azure CLI installed and logged in.
- Providers healthy: Run `kubectl get providers` and confirm "Healthy" status. If not, wait or debug (logs are your crystal ball).
- RBAC and XRD applied: `kubectl apply -f crossplane-compositevm-rbac.yaml` etc.

Pro Tip: Crossplane loves order. Reference resources in your YAML so it knows the creation sequence (e.g., create VNet before subnets). It's like telling a recipe: "Chop onions before saut√©ing!"

## Step-by-Step Deployment: Let's Conquer This! üõ°Ô∏è

### Step 1: Customize Your Lab (The Fun Part)
Edit `Env-Lab/values.yaml` to tailor the environment:
- Change `envName`, `location`, `resourceGroup`.
- Tweak VM specs: sizes, SSH keys, roles.
- Enable/disable components: Set `platform.createVNet: false` if you have an existing VNet.

Example tweak: Want bigger VMs? Set `vmSize: Standard_B4ms` for your DB masters.

### Step 2: Deploy with Helm
Helm is our deployment chariot. Run:

```bash
helm install ndc-env-lab ./Env-Lab
```

Watch the fireworks:
```bash
kubectl get compositevms  # Your custom VMs
kubectl get managed       # All underlying Azure resources
```

Helm will generate instances from `values.yaml` ‚Äì one chart, many resources. Boom! üéÜ

### Step 3: Monitor and Verify
- **Check Status**: Use `kubectl describe compositevm YOUR_VM_NAME` for details.
- **Azure Portal**: Log in and see your resources popping up (VNet, VMs, etc.).
- **SSH into VMs**: For public VMs, grab the public IP from Azure and SSH in (use your key!).

If something's stuck, Crossplane's reconciliation will retry. Patience, young padawan.

### Step 4: Updates and Cleanup
- **Modify**: Change `values.yaml` and `helm upgrade ndc-env-lab ./Env-Lab`.
- **Tear Down**: `helm uninstall ndc-env-lab` ‚Äì Crossplane cleans up Azure resources automatically. No leftover junk!

## Crossplane Superpowers: Why It's Awesome
- **Drift Detection & Reconciliation**: If Azure changes something (e.g., manual tweak), Crossplane spots it and fixes it back to your desired state. It's like having a self-healing robot! ü§ñ
- **Order Matters**: YAML references ensure dependencies (e.g., subnet needs VNet first). No chaos, just harmony.
- **Modular Providers**: We use specific ones (network, compute) for speed and freshness. The old Azure provider? Deprecated ‚Äì too slow, too bulky.

Fun Analogy: Crossplane is like a chef with a recipe book. You say "Make me a lab," and it follows the steps, adjusting if ingredients (resources) go awry.

## Troubleshooting: Dragon-Slaying Tips üêâ
- **Resources not creating?** Check provider health and logs: `kubectl logs -n crossplane-system provider-upbound-provider-azure-network`.
- **Auth issues?** Verify your SP secret.
- **Overlaps in CRDs?** Modular providers avoid this ‚Äì no 1000+ CRDs cluttering your cluster.
- **Stuck in reconciliation?** Describe the resource and look for events.

Still stuck? The Crossplane docs and community Slack are your allies.

## Next Level: Advanced Quests
- Integrate with GitOps (Flux/ArgoCD) for auto-deploys.
- Add more compositions for databases or storage.
- Explore functions like `patch-and-transform` for custom logic.

You've deployed your first Crossplane lab ‚Äì high-five! üöÄ For setup details, revisit `docs/getting-ready.md`. Questions? Hit the community. Onward to cloud domination! üåç
